<!DOCTYPE html>
<html lang="hu">
<head>
     <meta charset="utf-8">
     <link href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css" rel="stylesheet">
     <link rel="preconnect" href="https://fonts.googleapis.com">
     <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
     <link href="https://fonts.googleapis.com/css2?family=Hahmlet:wght@100;200;300;400;500;600;700;800;900&family=Montserrat:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
     <link href="https://fonts.googleapis.com/css2?family=EB+Garamond:wght@400;500;600;700;800&family=Hahmlet:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
     <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;600;700;800&display=swap" rel="stylesheet">
</head>
<style>
     .text-shadow {
          text-shadow: 0 2px 4px rgba(0,0,0,0.10);
     }
     
     .text-shadow-md {
          text-shadow: 0 4px 8px rgba(0,0,0,0.20), 0 2px 4px rgba(0,0,0,0.08);
     }
     
     .text-shadow-lg {
          text-shadow: 0 15px 30px rgba(0,0,0,0.11), 0 5px 15px rgba(0,0,0,0.08);
     }
     .text-shadow-white {
          text-shadow: 0 2px 4px rgba(255,255,255,0.10);
     }
     
     .text-shadow-white-md {
          text-shadow: 0 4px 8px rgba(255,255,255,0.20), 0 2px 4px rgba(0,0,0,0.24);
     }
     
     .text-shadow-white-lg {
          text-shadow: 0 15px 30px rgba(255,255,255,0.51), 0 5px 15px rgba(0,0,0,0.58);
     }
     
     .text-shadow-none {
          text-shadow: none;
     }
     .blur {
          filter: blur(3px);
          -webkit-filter: blur(3px);
     }
     .grayscale {
          filter: grayscale(100%);
          -webkit-filter: grayscale(100%);
     }
    @media screen and (-webkit-min-device-pixel-ratio: 0) {
     
        input[type="range"]::-webkit-slider-thumb {
            width: 15px;
            -webkit-appearance: none;
  			appearance: none;
            height: 15px;
            cursor: ew-resize;
            background: #FFF;
            box-shadow: -405px 0 0 400px #605E5C;
            border-radius: 50%;
            
        }
    }
</style>
<body class="px-2" style="font-family: 'Montserrat', sans-serif; min-width: 1024px;">
     <div class="container max-w-4xl mx-auto text-gray-800 p-8 border shadow shadow-md mt-12 mb-12">
          <h1 class="text-gray-500 text-xl">Bibliai idézetecskék &lt;3</h1>   
          <form class="mt-6">
               <label for="quote" class="text-gray-600">Idézet:</label>
               <textarea class="border border-gray-300 w-full p-2 px-3 focus:outline-none mt-1 mb-2" id="quote" maxlength="384">Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</textarea>
               <label for="author" class="text-gray-600">Szerző:</label>
               <input type="text" class="border border-gray-300 w-full p-2 px-3 focus:outline-none mt-1 mb-5" id="author" value="John Doe 13:22">
               <label for="fontsize" class="text-gray-600">Betűméret:</label>
               <input id="fontsize" class="rounded-lg overflow-hidden appearance-none bg-gray-400 h-3 w-full mb-5 mt-1" type="range" min="50" max="200" step="5" value="100" />
               <label for="image" class="text-gray-600">Háttér:</label>
               <input class="hidden mb-5" type="file" id="imgfile">
               <ul id="image" class="flex flex-wrap pt-2">
                    <li id="wesley" class="border-4 border-indigo-500 opacity-75 ml-1 cursor-pointer" onclick="setBackground(this)"><div class="w-48 h-48 bg-gray-300 flex justify-center"><img class="object-contain h-48" src="wesley.jpg"></div></li>
                    <li id="cross" class="border-4 opacity-50 border-white ml-1 cursor-pointer" onclick="setBackground(this)"><div class="w-48 h-48 bg-gray-300 flex justify-center"><img class="object-contain h-48" src="cross.jpg"></div></li>
                    <li id="christ" class="border-4 opacity-50 border-white ml-1 cursor-pointer" onclick="setBackground(this)"><div class="w-48 h-48 bg-gray-300 flex justify-center"><img class="object-contain h-48" src="christ.jpg"></div></li>
                    <li id="bible" class="border-4 opacity-50 border-white ml-1 cursor-pointer" onclick="setBackground(this)"><div class="w-48 h-48 bg-gray-300 flex justify-center"><img class="object-contain h-48" src="bible.jpg"></div></li>
                    <li id="paul" class="border-4 opacity-50 border-white ml-1 cursor-pointer" onclick="setBackground(this)"><div class="w-48 h-48 bg-gray-300 flex justify-center"><img class="object-contain h-48" src="paul.jpg"></div></li>
                    <li id="luther" class="border-4 opacity-50 border-white ml-1 cursor-pointer" onclick="setBackground(this)"><div class="w-48 h-48 bg-gray-300 flex justify-center"><img class="object-contain h-48" src="luther.jpg"></div></li>
                    <li id="kalvin" class="border-4 opacity-50 border-white ml-1 cursor-pointer" onclick="setBackground(this)"><div class="w-48 h-48 bg-gray-300 flex justify-center"><img class="object-contain h-48" src="kalvin.png"></div></li>
                    <li id="upload" class="border-4 opacity-50 border-white ml-1 cursor-pointer" onclick="chooseFile()"><div type="file" class="w-48 h-48 bg-gray-300 flex justify-center text-gray-600 text-6xl items-center">+</div></li>
               </ul>
          </form>
          <div class="flex justify-center mt-4">
               <button class="bg-gray-400 p-3 px-5 rounded-sm text-white mx-1 hover:bg-gray-500 cursor-pointer text-sm w-60" id="generate" onclick="generate()">Generál</button>
               <button class="bg-gray-400 p-3 px-5 rounded-sm text-white hover:bg-gray-500 cursor-pointer text-sm w-60" onclick="reset()">Töröl</button>
          </div>
          <div id="imgDiv" class="mt-8 relative bg-white hidden">
               <img src="wesley.jpg" class="object-contain opacity-70 w-full" id="bgimage">
               <div class="text-gray-700 absolute tracking-wider w-full" style="left: 50%; bottom:10%">
                    <div id="imgText" class="relative font-medium opacity-80 bg-white p-20 px-20 border-gray-400" style="left:-50%; font-family: 'EB Garamond'; line-height: 2em; border-left-width:10px; border-color: #66abcf;">
                         <p id="quoteText">„”</p>
                         <p id="quoteAuthor" class="italic mt-3 text-gray-600" style="font-size:0.9em;">()</p>
                    </div>
               </div>
          </div>
          <div class="mt-8 hidden" id="canvasDiv">
               <canvas id="canvas2"></canvas>
          </div>
     </div>
     <script src="https://cdn.rawgit.com/tsayen/dom-to-image/bfc00a6c5bba731027820199acd7b0a6e92149d8/dist/dom-to-image.min.js"></script>
     <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.2.2/html2canvas.min.js"></script>
     <script src="https://superal.github.io/canvas2image/canvas2image.js"></script>
     <script>
          var background = document.getElementById('wesley');
          var plusimgs = new Object();
          var plusid = 1;

          window.addEventListener('load', function() {
               document.querySelector('input[type="file"]').addEventListener('change', function() {
                    if (this.files && this.files[0]) {
                         var images = document.getElementById('image');
                         images.innerHTML += '<li id="plus" name="plus" class="border-4 opacity-50 border-white ml-1 cursor-pointer" onclick="setBackground(this)"><div class="w-48 h-48 bg-gray-300 flex justify-center"><img class="object-contain h-48" src=""></div></li>'
                         
                         var element = images.children[images.children.length - 1];
                         var img = element.querySelector('img');
                         var id = 'plus' + plusid.toString();

                         element.id = id;
                         plusid++;

                         img.onload = () => {
                              URL.revokeObjectURL(img.src);
                         }
                         img.src = URL.createObjectURL(this.files[0]);
                         plusimgs[id] = this.files[0];
                         setBackground(document.getElementById(id));

                         for (var node of document.querySelectorAll('li[name="plus"]')) {
                              node.querySelector('img').src = URL.createObjectURL(plusimgs[node.id]);
                         }
                         var upload = document.getElementById('upload');
                         var newUpload = upload.cloneNode(true);
                         upload.remove();
                         images.appendChild(newUpload);
                    }
               });
          });
          function setBackground(element) {
               background = element;
               for (var node of document.getElementById('image').children) {
                    node.classList.remove("opacity-75");
                    node.classList.remove("border-indigo-500");
                    node.classList.add("border-white");
                    node.classList.add("opacity-50");
               }
               background.classList.add("opacity-75");
               background.classList.add("border-indigo-500");
               background.classList.remove("border-white");
               background.classList.remove("opacity-50");
               if (element.getAttribute('name') == 'plus') {
                    document.getElementById('bgimage').setAttribute('src', URL.createObjectURL(plusimgs[element.id]));
               } else {
                    document.getElementById('bgimage').setAttribute('src', background.querySelector('img').getAttribute('src'));
               }
          }
          function chooseFile() {
               document.getElementById('imgfile').click();
          }
          function generate() {
               document.getElementById('quoteText').textContent = '„' + document.getElementById('quote').value + '”';
               document.getElementById('quoteAuthor').textContent = '(' + document.getElementById('author').value + ')';
               document.getElementById('imgDiv').classList.remove('hidden');
               document.getElementById('canvasDiv').innerHTML = "";
               document.getElementById('imgText').style.fontSize = (1.68 * document.getElementById('fontsize').value / 100).toString() + 'rem';
               html2canvas(document.getElementById('imgDiv')).then(function(arg) {
                    arg.id = "canvas";
                    document.getElementById('canvasDiv').appendChild(arg);
                    document.getElementById('canvasDiv').classList.remove('hidden');
                    document.getElementById('imgDiv').classList.add('hidden');
               });
          }
          function reset() {
               document.getElementById('canvasDiv').innerHTML = "";
          }
     </script>
</body>
</html>